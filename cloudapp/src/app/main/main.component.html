<!-- Entity-based set selection -->
<div class="eca-actions">


  <!-- Show instruction when no sets are available -->
  <div *ngIf="!hasValidSets && !loading" class="instruction-message">
    <div class="instruction-card">
      <h3>Navigate to a Set Page</h3>
      <p>
        Please navigate to a page that contains a set of users with notes. Once a Users set is selected, the list will populate with user records and you can configure your job parameters.
      </p>
    </div>
  </div>

  <!-- Show available sets for selection -->
  <div *ngIf="hasValidSets && !selectedSet" class="set-selection">
    <h3>Available Sets on This Page</h3>
    <div>
      <p>Select a set to load its user members:</p>
      <div *ngFor="let set of availableSets" class="set-option">
        <button
          mat-flat-button
          color="secondary"
          class="set-button"
          (click)="selectSet(set)"
          [disabled]="loading || processingNotes"
        >
          <strong>{{ set.description || 'Set ID: ' + set.id }}</strong>
          <small>ID: {{ set.id }}</small>
        </button>
      </div>
    </div>
  </div>

  <!-- Show selected set info -->
  <div *ngIf="selectedSet" class="selected-set-info">
    <div class="selected-set-card card card-primary">
      <!-- Compact Header (always visible) -->
      <div
        (click)="toggleSetDetails = !toggleSetDetails"
        class="compact-header border-bottom-primary bg-surface"
      >
        <div class="header-left">
          <span class="title">{{ selectedSet.description || 'Set ID: ' + selectedSet.id }}</span>
          <div *ngIf="!loading && setMembers && setMembers.length > 0" class="chips-row">
            <span class="chip chip-primary">{{ setMembers.length }} total</span>
            <span *ngIf="totalUsersWithNotes > 0" class="chip chip-secondary">{{ totalUsersWithNotes }} with notes</span>
          </div>
          <div *ngIf="loading" class="text-default subtext">Loading...</div>
        </div>
        <div class="header-actions">
          <button
            mat-flat-button
            color="secondary"
            class="small-button"
            (click)="clear(); $event.stopPropagation()"
            [disabled]="loading || processingNotes"
          >
            Change
          </button>
          <span class="toggle-icon" [class.rotated]="toggleSetDetails">‚ñº</span>
        </div>
      </div>
      
      <!-- Expandable Details -->
  <div *ngIf="toggleSetDetails" class="border-top-primary">
        <!-- Loading State -->
        <div *ngIf="loading" class="loading-section text-default bg-surface">
          <div class="mb-8">üîÑ Loading set members...</div>
          <div class="subtext">Please wait while we fetch the user data.</div>
        </div>
        
        <!-- Loaded Details -->
        <div *ngIf="!loading && setMembers && setMembers.length > 0" class="details-section bg-surface">
          <!-- Set Info -->
          <div class="set-info border-bottom">
            <div class="subtext text-default">Set Details</div>
            <div class="small-text">ID: {{ selectedSet.id }}</div>
          </div>
          
          <!-- Statistics Grid -->
          <div class="stats-grid">
            <!-- Total Users -->
            <div class="card card-tertiary stat-card">
              <div class="stat-value text-tertiary">{{ setMembers.length }}</div>
              <div class="stat-label text-tertiary">Total Users</div>
            </div>
            
            <!-- Users with Notes -->
            <div *ngIf="totalUsersWithNotes > 0" class="card card-secondary stat-card">
              <div class="stat-value text-secondary">{{ totalUsersWithNotes }}</div>
              <div class="stat-label text-secondary">With Notes</div>
            </div>
            
            <!-- Users without Notes -->
            <div *ngIf="totalUsersWithoutNotes > 0" class="card stat-card">
              <div class="stat-value">{{ totalUsersWithoutNotes }}</div>
              <div class="stat-label text-default">Without Notes</div>
            </div>
          </div>
          
          <!-- Status Message -->
          <div *ngIf="totalUsersWithNotes > 0" class="status-box border-left-success">
            <div class="status-title text-tertiary">Ready for Processing</div>
            <div class="subtext">{{ totalUsersWithNotes }} user{{ totalUsersWithNotes !== 1 ? 's' : '' }} with notes available</div>
          </div>
          
          <div *ngIf="totalUsersWithNotes === 0" class="status-box border-left">
            <div class="status-title text-default">No Notes Found</div>
            <div class="subtext">This set contains no users with notes to process</div>
          </div>
        </div>
        
        <!-- No Members Found -->
        <div *ngIf="!loading && (!setMembers || setMembers.length === 0)" class="loading-section text-default bg-surface">
          <div class="mb-8">‚ö†Ô∏è No members found</div>
          <div class="subtext">This set appears to be empty or inaccessible.</div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Operation selection step -->
<div *ngIf="usersWithNotes && usersWithNotes.length > 0 && operationMode === 'choose'" class="job-configuration card card-pad mt-20">
  <h3>Select Operation</h3>
  <div>
    <button mat-flat-button color="primary" [disabled]="loading || processingNotes" (click)="onClickDeleteAll()">
      Delete All Notes
    </button>
    <div class="text-default mt-6 small-text">
      <div>Delete All Notes: Removes every note from every user in the selected set. This cannot be undone.</div>
    </div>
    <!-- Inline confirmation panel -->
    <div *ngIf="showDeleteAllConfirm" class="card confirm-panel">
      <div class="confirm-title">Confirm Delete All Notes</div>
      <div class="text-default small-text">This will delete ALL notes for ALL users in the selected set. This action cannot be undone.</div>
      <div class="action-row mt-10">
        <button mat-flat-button color="primary" [disabled]="processingNotes" (click)="executeDeleteAllNotes()">Yes, Delete All Notes</button>
        <span class="flex-spacer"></span>
        <button mat-flat-button color="secondary" [disabled]="processingNotes" (click)="cancelDeleteAll()">Cancel</button>
      </div>
    </div>
  </div>
  <div class="spacer-16"></div>
  <div>
    <button mat-flat-button color="secondary" [disabled]="loading || processingNotes" (click)="chooseMenuFlow()">
      Modify or Delete Specific Notes
    </button>
    <div class="text-default mt-6 small-text">
      <div>Modify or Delete Specific Notes: Configure filters and actions to target specific notes.</div>
    </div>
  </div>
</div>

<!-- Menu-Based Job Configuration -->
<div *ngIf="usersWithNotes && usersWithNotes.length > 0 && operationMode === 'menu'" class="job-configuration dense">
  
  <!-- Job Parameters Window -->
  <div class="job-parameters-window card card-primary card-pad mb-24">
    <div class="header-row">
      <h3>Job Parameters</h3>
      <div *ngIf="jobExecuted && !processingNotes" class="chip chip-tertiary pill">
        ‚úì EXECUTED
      </div>
      <div *ngIf="processingNotes" class="chip chip-secondary pill">
        ‚è≥ PROCESSING...
      </div>
    </div>
    
    <div *ngIf="jobParameters.length === 0" class="empty-parameters text-default italic">
      No parameters configured. Select options from the menu below to build your job.
    </div>
    
    <!-- Action Parameter (non-editable) -->
    <div *ngIf="actionParam" class="parameter-item card">
      <div class="param-row">
        <div class="param-col">
          <h4>{{ actionParam.label }}</h4>
          <strong>{{ actionParam.value === 'modify' ? 'Modify matching notes' : 'Delete matching notes' }}</strong>
        </div>
        <button *ngIf="!jobExecuted" mat-flat-button color="secondary" (click)="removeJobParameter(actionParam.id)" class="small-button" title="Remove this parameter">‚úï</button>
      </div>
    </div>

    <!-- Text Search Parameter -->
    <div *ngIf="textSearchParam" class="parameter-item card">
      <div class="param-row">
        <div class="param-col">
          <h4>{{ textSearchParam.label }}</h4>
          <div class="param-grid">
            <mat-form-field class="mw-240">
              <mat-label>Search text</mat-label>
              <input matInput type="text" [value]="textSearchParam.value.text" (input)="updateJobParameter('textSearch', { text: $any($event.target).value, caseSensitive: textSearchParam.value.caseSensitive, matchMode: textSearchParam.value.matchMode, ignoreAccents: textSearchParam.value.ignoreAccents })" placeholder="Enter text to search for" [disabled]="jobExecuted">
            </mat-form-field>
            <mat-checkbox labelPosition="before" [checked]="textSearchParam.value.caseSensitive" (change)="updateJobParameter('textSearch', { text: textSearchParam.value.text, caseSensitive: $event.checked, matchMode: textSearchParam.value.matchMode, ignoreAccents: textSearchParam.value.ignoreAccents })" [disabled]="jobExecuted">Case sensitive search</mat-checkbox>
            <div class="inline-controls">
              <mat-form-field class="mw-180">
                <mat-label>Match</mat-label>
                <mat-select [value]="textSearchParam.value.matchMode || 'substring'" (selectionChange)="updateJobParameter('textSearch', { text: textSearchParam.value.text, caseSensitive: textSearchParam.value.caseSensitive, matchMode: $event.value, ignoreAccents: textSearchParam.value.ignoreAccents })" [disabled]="jobExecuted">
                  <mat-option value="substring">Substring</mat-option>
                  <mat-option value="wholeWord">Whole word</mat-option>
                  <mat-option value="exact">Exact</mat-option>
                </mat-select>
              </mat-form-field>
              <mat-checkbox labelPosition="before" [checked]="(textSearchParam.value.ignoreAccents ?? true)" (change)="updateJobParameter('textSearch', { text: textSearchParam.value.text, caseSensitive: textSearchParam.value.caseSensitive, matchMode: textSearchParam.value.matchMode, ignoreAccents: $event.checked })" [disabled]="jobExecuted">Ignore accents (√© ‚âà e)</mat-checkbox>
            </div>
          </div>
        </div>
        <button *ngIf="!jobExecuted" mat-flat-button color="secondary" (click)="removeJobParameter(textSearchParam.id)" class="small-button" title="Remove this parameter">‚úï</button>
      </div>
    </div>

    <!-- Date Range Parameter -->
    <div *ngIf="dateRangeParam" class="parameter-item card">
      <div class="param-row">
        <div class="param-col">
          <h4>{{ dateRangeParam.label }}</h4>
          <div class="inline-controls">
            <mat-form-field class="mw-200">
              <mat-label>From</mat-label>
              <input matInput type="date" [value]="dateRangeParam.value.startDate" (input)="updateJobParameter('dateRange', { startDate: $any($event.target).value, endDate: dateRangeParam.value.endDate })" [disabled]="jobExecuted">
            </mat-form-field>
            <mat-form-field class="mw-200">
              <mat-label>To</mat-label>
              <input matInput type="date" [value]="dateRangeParam.value.endDate" (input)="updateJobParameter('dateRange', { startDate: dateRangeParam.value.startDate, endDate: $any($event.target).value })" [disabled]="jobExecuted">
            </mat-form-field>
          </div>
        </div>
        <button *ngIf="!jobExecuted" mat-flat-button color="secondary" (click)="removeJobParameter(dateRangeParam.id)" class="small-button" title="Remove this parameter">‚úï</button>
      </div>
    </div>

    <!-- Popup Settings Parameter (radio group) -->
    <div *ngIf="popupParam" class="parameter-item card">
      <div class="param-row">
        <div class="param-col">
          <h4>{{ popupParam.label }}</h4>
          <mat-radio-group class="inline-controls" [disabled]="jobExecuted">
            <mat-radio-button (change)="updateJobParameter('popupSettings', { makePopup: true, disablePopup: false })" [checked]="popupParam.value.makePopup === true">Make popup note</mat-radio-button>
            <mat-radio-button (change)="updateJobParameter('popupSettings', { makePopup: false, disablePopup: true })" [checked]="popupParam.value.disablePopup === true">Disable popup</mat-radio-button>
          </mat-radio-group>
        </div>
        <button *ngIf="!jobExecuted" mat-flat-button color="secondary" (click)="removeJobParameter(popupParam.id)" class="small-button" title="Remove this parameter">‚úï</button>
      </div>
    </div>

    <!-- User Viewable Parameter (radio group) -->
    <div *ngIf="userViewableParam" class="parameter-item card">
      <div class="param-row">
        <div class="param-col">
          <h4>{{ userViewableParam.label }}</h4>
          <mat-radio-group class="inline-controls" [disabled]="jobExecuted">
            <mat-radio-button (change)="updateJobParameter('userViewable', { makeUserViewable: true })" [checked]="userViewableParam.value.makeUserViewable === true">True</mat-radio-button>
            <mat-radio-button (change)="updateJobParameter('userViewable', { makeUserViewable: false })" [checked]="userViewableParam.value.makeUserViewable === false">False</mat-radio-button>
          </mat-radio-group>
        </div>
        <button *ngIf="!jobExecuted" mat-flat-button color="secondary" (click)="removeJobParameter(userViewableParam.id)" class="small-button" title="Remove this parameter">‚úï</button>
      </div>
    </div>

    <!-- Note Type Parameter -->
    <div *ngIf="noteTypeParam" class="parameter-item card">
      <div class="param-row">
        <div class="param-col">
          <h4>{{ noteTypeParam.label }}</h4>
          <div *ngIf="noteTypeParam.value" class="selected-note-type text-tertiary">
            Selected: {{ noteTypeParam.value.desc }}
          </div>
          <mat-form-field class="mw-240">
            <mat-label>New note type</mat-label>
            <mat-select [value]="noteTypeParam.value?.value || ''" (selectionChange)="updateJobParameter('noteType', getNoteTypeByValue($event.value))" [disabled]="jobExecuted">
              <mat-option value="">Select a note type...</mat-option>
              <mat-option *ngFor="let noteType of availableNoteTypes" [value]="noteType.value">{{ noteType.desc }}</mat-option>
            </mat-select>
          </mat-form-field>
        </div>
        <button *ngIf="!jobExecuted" mat-flat-button color="secondary" (click)="removeJobParameter(noteTypeParam.id)" class="small-button" title="Remove this parameter">‚úï</button>
      </div>
    </div>
    
    <!-- Execute Job Button (only shown before job execution) -->
  <div class="center mt-20">
      <button 
        *ngIf="!jobExecuted"
        mat-flat-button
        color="primary"
        class="execute-job-button"
        [disabled]="!canExecuteJob || loading || processingNotes"
        (click)="processUserNotes()"
      >
        Execute Job
      </button>
      
      <!-- Reset Job Button (shown after job execution) -->
      <button 
        *ngIf="jobExecuted && !processingNotes && operationMode === 'menu'"
        mat-flat-button
        color="primary"
        class="reset-job-button"
        (click)="resetJob()"
      >
        Configure New Job
      </button>
      
  <div *ngIf="!canExecuteJob && !jobExecuted" class="mt-16">
        <div *ngIf="!hasActionParameter" 
          class="chip chip-secondary chip-lg mb-8">
          ‚ñ∫ Please select an action (modify or delete).
        </div>
        <div *ngIf="hasActionParameter && !hasSearchParameter" 
          class="chip chip-secondary chip-lg mb-8">
          ‚ñ∫ Please add search criteria.
        </div>
        <div *ngIf="needsModificationOptions" 
          class="chip chip-secondary chip-lg mb-8">
          ‚ñ∫ Please select modification options.
        </div>
      </div>
    </div>
    
    <!-- Progress Bar -->
    <div *ngIf="processingNotes" class="mt-15">
      <mat-progress-bar mode="determinate" [value]="percentComplete"></mat-progress-bar>
      <div class="center mt-5 text-default">
        Processing {{ processed }} of {{ recordsToProcess }} users... ({{percentComplete}}%)
      </div>
    </div>
  </div>
  
  <!-- Menu Options (hidden after job execution) -->
  <div *ngIf="!jobExecuted" class="menu-options card card-pad">
    <h3>Available Options</h3>
    
    <div *ngIf="availableMenuOptions.length === 0" class="center italic pad-20 text-default">
      All available options have been added to your job parameters.
    </div>
    
    <div *ngIf="availableMenuOptions.length > 0" class="option-categories">
      <!-- Action Options -->
      <div *ngIf="getMenuOptionsByCategory('action').length > 0" class="option-category mb-24">
        <h4 class="text-secondary mb-10">Actions</h4>
        <div class="button-wrap gap-8">
          <button 
            *ngFor="let option of getMenuOptionsByCategory('action')"
            (click)="addJobParameter(option.id)"
            mat-flat-button
            color="primary"
            class="menu-option-button"
          >
            {{ option.label }}
            <small class="text-default">{{ option.description }}</small>
          </button>
        </div>
      </div>
      
      <!-- Search Options -->
      <div *ngIf="getMenuOptionsByCategory('search').length > 0" class="option-category mb-24">
        <h4 class="text-primary mb-10">Filter Criteria</h4>
        <div class="button-wrap gap-8">
          <button 
            *ngFor="let option of getMenuOptionsByCategory('search')"
            (click)="addJobParameter(option.id)"
            mat-flat-button
            color="secondary"
            class="menu-option-button"
          >
            {{ option.label }}
            <small class="text-default">{{ option.description }}</small>
          </button>
        </div>
      </div>
      
      <!-- Modification Options -->
      <div *ngIf="getMenuOptionsByCategory('modification').length > 0" class="option-category mb-24">
        <h4 class="text-tertiary mb-10">Modification Options</h4>
        <div class="button-wrap gap-8">
          <button 
            *ngFor="let option of getMenuOptionsByCategory('modification')"
            (click)="addJobParameter(option.id)"
            mat-flat-button
            color="secondary"
            class="menu-option-button"
          >
            {{ option.label }}
            <small class="text-default">{{ option.description }}</small>
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Processing Logs -->
<div *ngIf="processLogs && processLogs.length > 0" class="processing-results card card-pad mt-30">
  <h3>Processing Results</h3>
  
  <!-- Summary -->
  <div class="summary-box border-left-success mb-20 pad-10">
    <div class="text-tertiary bold">Summary:</div>
    <div>Total users processed: {{ processLogs.length }}</div>
    <div>Users with changes: {{ processLogsWithChanges.length }}</div>
    <div>Users with no matching notes: {{ processLogs.length - processLogsWithChanges.length }}</div>
  </div>
  
  <!-- Action Buttons -->
  <div class="action-row mb-20 center">
    <button 
      (click)="showResults = !showResults"
      mat-flat-button
      color="primary"
    >
      {{ showResults ? 'Hide Results' : 'View Results' }}
    </button>
    <button 
      (click)="exportResultsToCSV()"
      mat-flat-button
      color="secondary"
    >
      Export to CSV
    </button>
    <button 
      *ngIf="operationMode === 'deleteAll' && jobExecuted && !processingNotes"
      (click)="clear()"
      mat-flat-button
      color="secondary"
    >
      Browse New Set
    </button>
  </div>
  
  <!-- Detailed Results (collapsible) -->
  <div *ngIf="showResults">
    <!-- Show message if no users had changes -->
    <div *ngIf="processLogsWithChanges.length === 0" class="center italic pad-20 text-default">
      No users had notes that were modified or deleted.
    </div>
    
    <!-- Show only users with changes -->
    <div *ngIf="processLogsWithChanges.length > 0" class="card results-scroll pad-10">
      <div *ngFor="let log of processLogsWithChanges" class="user-change-card border-bottom mb-15 pb-15">
        <h4 class="text-primary mb-10">User ID: {{ log.userId }}</h4>
      <div>
          <div *ngFor="let entry of log.notes" class="note-entry card note-entry-pad">
            <div *ngIf="entry.deleted" class="text-error bold mb-8">üìù NOTE DELETED</div>
            <div *ngIf="!entry.deleted" class="text-warning bold mb-8">üìù NOTE MODIFIED</div>
          
          <div *ngIf="!entry.deleted">
            <div class="mb-8">
              <strong>Before:</strong>
              <div class="before-after-box border-left-primary pad-5 mt-4">
                <div><strong>Text:</strong> {{ entry.before.note_text }}</div>
                <div><strong>Created:</strong> {{ formatNoteDate(entry.before) }}</div>
                <div><strong>Popup:</strong> {{ entry.before.popup_note ? 'Yes' : 'No' }}</div>
                <div><strong>User Viewable:</strong> {{ entry.before['user_viewable'] ? 'Yes' : 'No' }}</div>
                <div><strong>Type:</strong> {{ entry.before.note_type?.desc || 'None' }}</div>
              </div>
            </div>
            <div *ngIf="entry.after">
              <strong>After:</strong>
              <div class="before-after-box border-left-success pad-5 mt-4">
                <div><strong>Text:</strong> {{ entry.after.note_text }}</div>
                <div><strong>Created:</strong> {{ formatNoteDate(entry.after) }}</div>
                <div><strong>Popup:</strong> {{ entry.after.popup_note ? 'Yes' : 'No' }}</div>
                <div><strong>User Viewable:</strong> {{ entry.after['user_viewable'] ? 'Yes' : 'No' }}</div>
                <div><strong>Type:</strong> {{ entry.after.note_type?.desc || 'None' }}</div>
              </div>
            </div>
          </div>
          
          <div *ngIf="entry.deleted">
            <div class="mb-8">
              <strong>Deleted Note:</strong>
              <div class="before-after-box border-left-error pad-5 mt-4">
                <div><strong>Text:</strong> {{ entry.before.note_text }}</div>
                <div><strong>Created:</strong> {{ formatNoteDate(entry.before) }}</div>
                <div><strong>Popup:</strong> {{ entry.before.popup_note ? 'Yes' : 'No' }}</div>
                <div><strong>User Viewable:</strong> {{ entry.before['user_viewable'] ? 'Yes' : 'No' }}</div>
                <div><strong>Type:</strong> {{ entry.before.note_type?.desc || 'None' }}</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- User display with note highlighting -->
<div>
  <!-- Show set summary before job execution -->
  <section *ngIf="users && users.length > 0 && !jobExecuted" class="card card-primary mt-30 section-head">
    <h2>
      üìã Set Summary
    </h2>
    
    <div class="bg-surface pad-20">
      <!-- Summary Cards -->
      <div class="grid-cards mb-20">
        
        <!-- Total Users Card -->
        <div class="card card-tertiary summary-card">
          <div class="summary-value text-tertiary">{{ totalUsersInSet }}</div>
          <div class="summary-label text-tertiary">Total Users in Set</div>
        </div>
        
        <!-- Users with Notes Card -->
        <div class="card card-secondary summary-card">
          <div class="summary-value text-secondary">{{ totalUsersWithNotes }}</div>
          <div class="summary-label text-secondary">Users with Notes</div>
          <div class="summary-subtext text-default">(Will be processed by job)</div>
        </div>
        
        <!-- Users without Notes Card -->
        <div class="card summary-card">
          <div class="summary-value">{{ totalUsersWithoutNotes }}</div>
          <div class="summary-label text-default">Users without Notes</div>
          <div class="summary-subtext text-default">(Will be skipped)</div>
        </div>
      </div>
      
      <!-- Additional Info -->
      <div class="card border-left-primary pad-15">
        <h4 class="text-primary">üí° Processing Information</h4>
        <ul class="no-mb">
          <li>Only users with notes will be processed during job execution</li>
          <li>Users without notes will be automatically skipped for efficiency</li>
          <li>Configure your job parameters above, then click "Execute Job" to begin</li>
        </ul>
      </div>
    </div>
  </section>
  
  <!-- Debugging section for when users should exist but don't show -->
  <section *ngIf="selectedSet && setMembers && setMembers.length > 0 && (!users || users.length === 0) && !loading" class="card card-secondary mt-30 pad-20">
    <h2 class="text-secondary">‚ö†Ô∏è Debug: Users Not Loading</h2>
    <p>Set is selected and members are found, but user details are not loading.</p>
    <p><strong>Set Members Found:</strong> {{ setMembers.length }}</p>
    <p><strong>User Details Loaded:</strong> {{ userDetails.length || 0 }}</p>
    <p><strong>Users Getter Result:</strong> {{ users.length || 0 }}</p>
    <p><strong>Loading State:</strong> {{ loading }}</p>
    <div class="card pad-10 mt-10">
      <strong>First few set members:</strong>
      <div *ngFor="let member of setMembers.slice(0, 3)">
        - {{ member.name }} ({{ member.id }})
      </div>
    </div>
  </section>
  
  <!-- Show basic set member info -->
  <section *ngIf="setMembers && setMembers.length > 0 && (!users || users.length === 0)" class="mt-50">
    <h2 class="text-primary">Set Members</h2>
    <ul class="pad-10">
      <li class="mb-5" *ngFor="let member of setMembers">
        <strong>Name:</strong> {{ member.name }} | 
        <strong>Id:</strong> {{ member.id }} | 
        <strong>Description:</strong> {{ member.description }} | 
        <strong>Link:</strong> <a href="{{member.link}}" target="_blank">{{member.link}}</a>
      </li>
    </ul>
  </section>
  
  <!-- Show empty list template when nothing is available -->
  <section *ngIf="selectedSet && (!setMembers || setMembers.length === 0) && !loading" class="mt-50">
    <ng-container *ngTemplateOutlet="emptyList"></ng-container>
  </section>
  
  <!-- Loading indicator -->
  <section *ngIf="loading || processingNotes" class="mt-50">
    <div class="loading-shade">
      <mat-progress-spinner mode="indeterminate" diameter="50"></mat-progress-spinner>
    </div>
  </section>
  
  <!-- Empty list template -->
  <ng-template #emptyList>
    <div id="emptyList">
      <span class="uxf-icon uxf-list"></span>
      <div>No items found for this set.</div>
    </div>
  </ng-template>
</div>