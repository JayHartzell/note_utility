<!-- Entity-based set selection -->
<div class="eca-actions">


  <!-- Show instruction when no sets are available -->
  <div *ngIf="!hasValidSets && !loading" class="instruction-message">
    <div class="instruction-card">
      <h3>Navigate to a Set Page</h3>
      <p>
        Please navigate to a page that contains a set of users with notes. Once a Users set is selected, the list will populate with user records and you can configure your job parameters.
      </p>
    </div>
  </div>

  <!-- Show available sets for selection -->
  <div *ngIf="hasValidSets && !selectedSet" class="set-selection">
    <h3>Available Sets on This Page</h3>
    <div>
      <p>Select a set to load its user members:</p>
      <div *ngFor="let set of availableSets" class="set-option">
        <button 
          class="set-button"
          (click)="selectSet(set)"
          [disabled]="loading || processingNotes"
        >
          <strong>{{ set.description || 'Set ID: ' + set.id }}</strong>
          <small>ID: {{ set.id }}</small>
        </button>
      </div>
    </div>
  </div>

  <!-- Show selected set info -->
  <div *ngIf="selectedSet" class="selected-set-info">
    <div class="selected-set-card" style="border: 2px solid var(--primary-color, #1976D2); background-color: white; border-radius: 6px; overflow: hidden;">
      <!-- Compact Header (always visible) -->
      <div 
        (click)="toggleSetDetails = !toggleSetDetails" 
        style="padding: 12px 15px; cursor: pointer; background: white; color: #1A237E; display: flex; justify-content: space-between; align-items: center; user-select: none; border-bottom: 1px solid var(--primary-color, #1976D2);"
      >
        <div style="display: flex; align-items: center; gap: 12px;">
          <span style="font-weight: bold; font-size: 14px; color: #1A237E;">{{ selectedSet.description || 'Set ID: ' + selectedSet.id }}</span>
          <div *ngIf="!loading && setMembers && setMembers.length > 0" style="display: flex; gap: 8px; font-size: 12px;">
            <span style="background: var(--primary-color, #1976D2); color: white; padding: 2px 6px; border-radius: 10px;">{{ setMembers.length }} total</span>
            <span *ngIf="totalUsersWithNotes > 0" style="background: var(--warning-color, #FF9800); color: white; padding: 2px 6px; border-radius: 10px;">{{ totalUsersWithNotes }} with notes</span>
          </div>
          <div *ngIf="loading" style="font-size: 12px; color: var(--secondary-text-color, #666);">Loading...</div>
        </div>
        <div style="display: flex; align-items: center; gap: 10px;">
          <button 
            (click)="clear(); $event.stopPropagation()"
            [disabled]="loading || processingNotes"
            style="background: var(--primary-color, #1976D2); color: white; border: 1px solid var(--primary-color, #1976D2); padding: 4px 8px; border-radius: 3px; cursor: pointer; font-size: 11px;"
          >
            Change
          </button>
          <span style="font-size: 16px; transition: transform 0.2s; color: #1A237E;" [style.transform]="toggleSetDetails ? 'rotate(180deg)' : 'rotate(0deg)'">‚ñº</span>
        </div>
      </div>
      
      <!-- Expandable Details -->
      <div *ngIf="toggleSetDetails" style="border-top: 1px solid var(--primary-color, #1976D2);">
        <!-- Loading State -->
        <div *ngIf="loading" style="padding: 20px; text-align: center; color: var(--secondary-text-color, #666); background: white;">
          <div style="margin-bottom: 8px;">üîÑ Loading set members...</div>
          <div style="font-size: 12px;">Please wait while we fetch the user data.</div>
        </div>
        
        <!-- Loaded Details -->
        <div *ngIf="!loading && setMembers && setMembers.length > 0" style="padding: 15px; background: white;">
          <!-- Set Info -->
          <div style="margin-bottom: 15px; padding-bottom: 12px; border-bottom: 1px solid var(--border-color, #ddd);">
            <div style="font-size: 12px; color: var(--secondary-text-color, #666); margin-bottom: 4px;">Set Details</div>
            <div style="font-size: 13px; color: var(--text-color, #333);">ID: {{ selectedSet.id }}</div>
          </div>
          
          <!-- Statistics Grid -->
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 10px; margin-bottom: 15px;">
            <!-- Total Users -->
            <div style="background: white; border: 1px solid var(--success-color, #4CAF50); padding: 8px; border-radius: 4px; text-align: center;">
              <div style="font-size: 18px; font-weight: bold; color: var(--success-color, #4CAF50);">{{ setMembers.length }}</div>
              <div style="font-size: 10px; color: var(--success-color, #4CAF50);">Total Users</div>
            </div>
            
            <!-- Users with Notes -->
            <div *ngIf="totalUsersWithNotes > 0" style="background: white; border: 1px solid var(--warning-color, #FF9800); padding: 8px; border-radius: 4px; text-align: center;">
              <div style="font-size: 18px; font-weight: bold; color: var(--warning-color, #FF9800);">{{ totalUsersWithNotes }}</div>
              <div style="font-size: 10px; color: var(--warning-color, #FF9800);">With Notes</div>
            </div>
            
            <!-- Users without Notes -->
            <div *ngIf="totalUsersWithoutNotes > 0" style="background: white; border: 1px solid var(--muted-text-color, #9E9E9E); padding: 8px; border-radius: 4px; text-align: center;">
              <div style="font-size: 18px; font-weight: bold; color: var(--muted-text-color, #757575);">{{ totalUsersWithoutNotes }}</div>
              <div style="font-size: 10px; color: var(--muted-text-color, #757575);">Without Notes</div>
            </div>
          </div>
          
          <!-- Status Message -->
          <div *ngIf="totalUsersWithNotes > 0" style="background: white; border-left: 3px solid var(--success-color, #4CAF50); padding: 8px 12px; border-radius: 0 4px 4px 0;">
            <div style="color: var(--success-color, #2E7D32); font-weight: bold; font-size: 12px;">Ready for Processing</div>
            <div style="color: var(--text-color, #333); font-size: 11px;">{{ totalUsersWithNotes }} user{{ totalUsersWithNotes !== 1 ? 's' : '' }} with notes available</div>
          </div>
          
          <div *ngIf="totalUsersWithNotes === 0" style="background: white; border-left: 3px solid var(--muted-text-color, #9E9E9E); padding: 8px 12px; border-radius: 0 4px 4px 0;">
            <div style="color: var(--muted-text-color, #757575); font-weight: bold; font-size: 12px;">No Notes Found</div>
            <div style="color: var(--text-color, #333); font-size: 11px;">This set contains no users with notes to process</div>
          </div>
        </div>
        
        <!-- No Members Found -->
        <div *ngIf="!loading && (!setMembers || setMembers.length === 0)" style="padding: 20px; text-align: center; color: var(--secondary-text-color, #666); background: white;">
          <div style="margin-bottom: 8px;">‚ö†Ô∏è No members found</div>
          <div style="font-size: 12px;">This set appears to be empty or inaccessible.</div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- New Menu-Based Job Configuration -->
<div *ngIf="usersWithNotes && usersWithNotes.length > 0" class="job-configuration">
  
  <!-- Job Parameters Window -->
  <div class="job-parameters-window" style="margin-bottom: 20px; padding: 15px; border: 2px solid var(--primary-color, #1976D2); border-radius: 8px; background-color: white;">
    <div style="display: flex; justify-content: space-between; align-items: center;">
      <h3 style="margin-top: 0; color: var(--primary-text-color, #1976D2);">Job Parameters</h3>
      <div *ngIf="jobExecuted && !processingNotes" style="background: var(--success-color, #4CAF50); color: white; padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: bold;">
        ‚úì EXECUTED
      </div>
      <div *ngIf="processingNotes" style="background: var(--warning-color, #FF9800); color: white; padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: bold;">
        ‚è≥ PROCESSING...
      </div>
    </div>
    
    <div *ngIf="jobParameters.length === 0" class="empty-parameters" style="color: #666; font-style: italic;">
      No parameters configured. Select options from the menu below to build your job.
    </div>
    
    <div *ngFor="let parameter of jobParameters" class="parameter-item" style="margin-bottom: 15px; padding: 10px; background-color: white; border: 1px solid var(--border-color, #ddd); border-radius: 4px;">
      <div style="display: flex; justify-content: space-between; align-items: flex-start;">
        <div style="flex-grow: 1;">
          <h4 style="margin: 0 0 10px 0; color: var(--primary-text-color, #1976D2);">{{ parameter.label }}</h4>
          
          <!-- Action Parameter (non-editable) -->
          <div *ngIf="parameter.type === 'action'" style="color: var(--secondary-text-color, #424242);">
            <strong>{{ parameter.value === 'modify' ? 'Modify matching notes' : 'Delete matching notes' }}</strong>
          </div>
          
          <!-- Text Search Parameter -->
          <div *ngIf="parameter.id === 'textSearch'" style="display: flex; flex-direction: column; gap: 8px;">
            <div>
              <label>Search text:</label>
              <input 
                type="text" 
                [value]="parameter.value.text"
                (input)="updateJobParameter('textSearch', { text: $any($event.target).value, caseSensitive: parameter.value.caseSensitive })"
                placeholder="Enter text to search for"
                style="margin-left: 10px; padding: 4px; width: 200px;"
                [disabled]="jobExecuted"
              >
            </div>
            <div>
              <label>
                <input 
                  type="checkbox" 
                  [checked]="parameter.value.caseSensitive"
                  (change)="updateJobParameter('textSearch', { text: parameter.value.text, caseSensitive: $any($event.target).checked })"
                  [disabled]="jobExecuted"
                > 
                Case sensitive search
              </label>
            </div>
          </div>
          
          <!-- Date Range Parameter -->
          <div *ngIf="parameter.id === 'dateRange'" style="display: flex; gap: 15px;">
            <div>
              <label>From:</label>
              <input 
                type="date" 
                [value]="parameter.value.startDate"
                (input)="updateJobParameter('dateRange', { startDate: $any($event.target).value, endDate: parameter.value.endDate })"
                style="margin-left: 5px;"
                [disabled]="jobExecuted"
              >
            </div>
            <div>
              <label>To:</label>
              <input 
                type="date" 
                [value]="parameter.value.endDate"
                (input)="updateJobParameter('dateRange', { startDate: parameter.value.startDate, endDate: $any($event.target).value })"
                style="margin-left: 5px;"
                [disabled]="jobExecuted"
              >
            </div>
          </div>
          
          <!-- Popup Settings Parameter -->
          <div *ngIf="parameter.id === 'popupSettings'" style="display: flex; gap: 15px;">
            <label>
              <input 
                type="checkbox" 
                [checked]="parameter.value.makePopup"
                (change)="updateJobParameter('popupSettings', { makePopup: $any($event.target).checked, disablePopup: parameter.value.disablePopup })"
                [disabled]="jobExecuted"
              > 
              Make popup note
            </label>
            <label>
              <input 
                type="checkbox" 
                [checked]="parameter.value.disablePopup"
                (change)="updateJobParameter('popupSettings', { makePopup: parameter.value.makePopup, disablePopup: $any($event.target).checked })"
                [disabled]="jobExecuted"
              > 
              Disable popup
            </label>
          </div>
          
          <!-- Note Type Parameter -->
          <div *ngIf="parameter.id === 'noteType'">
            <label style="color: var(--secondary-text-color, #424242);">New note type:</label>
            <div *ngIf="parameter.value" style="margin-left: 10px; margin-bottom: 5px; font-weight: bold; color: var(--success-color, #4CAF50);">
              Selected: {{ parameter.value.desc }}
            </div>
            <select 
              [value]="parameter.value?.value || ''"
              (change)="updateJobParameter('noteType', getNoteTypeByValue($any($event.target).value))"
              style="margin-left: 10px; padding: 4px; width: 200px;"
              [disabled]="jobExecuted"
            >
              <option value="">Select a note type...</option>
              <option *ngFor="let noteType of availableNoteTypes" [value]="noteType.value">
                {{ noteType.desc }}
              </option>
            </select>
          </div>
        </div>
        
        <button 
          *ngIf="!jobExecuted"
          (click)="removeJobParameter(parameter.id)"
          style="background: #f44336; color: white; border: none; padding: 4px 8px; border-radius: 3px; cursor: pointer; margin-left: 10px;"
          title="Remove this parameter"
        >
          ‚úï
        </button>
      </div>
    </div>
    
    <!-- Execute Job Button (only shown before job execution) -->
    <div style="margin-top: 20px; text-align: center;">
      <button 
        *ngIf="!jobExecuted"
        class="execute-job-button"
        [disabled]="!canExecuteJob || loading || processingNotes"
        (click)="processUserNotes()"
        style="background: var(--success-color, #4CAF50); color: white; border: none; padding: 12px 24px; border-radius: 6px; font-size: 16px; cursor: pointer; font-weight: bold;"
        [style.opacity]="canExecuteJob ? '1' : '0.5'"
      >
        Execute Job
      </button>
      
      <!-- Reset Job Button (shown after job execution) -->
      <button 
        *ngIf="jobExecuted && !processingNotes"
        class="reset-job-button"
        (click)="resetJob()"
        style="background: var(--primary-color, #1976D2); color: white; border: none; padding: 12px 24px; border-radius: 6px; font-size: 16px; cursor: pointer; font-weight: bold;"
      >
        Configure New Job
      </button>
      
      <div *ngIf="!canExecuteJob && !jobExecuted" style="margin-top: 12px;">
        <div *ngIf="!hasActionParameter" 
             style="background: var(--warning-color, #FF9800); color: white; padding: 8px 12px; border-radius: 4px; font-size: 14px; font-weight: bold; margin-bottom: 8px;">
          ‚ñ∫ Please select an action (modify or delete).
        </div>
        <div *ngIf="hasActionParameter && !hasSearchParameter" 
             style="background: var(--warning-color, #FF9800); color: white; padding: 8px 12px; border-radius: 4px; font-size: 14px; font-weight: bold; margin-bottom: 8px;">
          ‚ñ∫ Please add search criteria.
        </div>
        <div *ngIf="needsModificationOptions" 
             style="background: var(--warning-color, #FF9800); color: white; padding: 8px 12px; border-radius: 4px; font-size: 14px; font-weight: bold; margin-bottom: 8px;">
          ‚ñ∫ Please select modification options.
        </div>
      </div>
    </div>
    
    <!-- Progress Bar -->
    <div *ngIf="processingNotes" style="margin-top: 15px;">
      <div style="height: 20px; background-color: #eee; border-radius: 4px; overflow: hidden;">
        <div 
          [style.width.%]="percentComplete"
          style="height: 100%; background-color: var(--success-color, #4CAF50); text-align: center; line-height: 20px; color: white;"
        >
          {{percentComplete}}%
        </div>
      </div>
      <div style="text-align: center; margin-top: 5px; color: var(--secondary-text-color, #666);">
        Processing {{ processed }} of {{ recordsToProcess }} users...
      </div>
    </div>
  </div>
  
  <!-- Menu Options (hidden after job execution) -->
  <div *ngIf="!jobExecuted" class="menu-options" style="padding: 15px; border: 1px solid var(--border-color, #ddd); border-radius: 8px; background-color: white;">
    <h3 style="color: var(--primary-text-color, #1976D2);">Available Options</h3>
    
    <div *ngIf="availableMenuOptions.length === 0" style="text-align: center; color: var(--secondary-text-color, #666); font-style: italic; padding: 20px;">
      All available options have been added to your job parameters.
    </div>
    
    <div *ngIf="availableMenuOptions.length > 0" class="option-categories">
      <!-- Action Options -->
      <div *ngIf="getMenuOptionsByCategory('action').length > 0" class="option-category" style="margin-bottom: 20px;">
        <h4 style="color: #B71C1C; margin-bottom: 10px;">Actions</h4>
        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
          <button 
            *ngFor="let option of getMenuOptionsByCategory('action')"
            (click)="addJobParameter(option.id)"
            class="menu-option-button"
            style="padding: 8px 16px; border: 1px solid #B71C1C; background: white; color: #B71C1C; border-radius: 4px; cursor: pointer; transition: all 0.2s;"
            onmouseover="this.style.backgroundColor='#B71C1C'; this.style.color='white'"
            onmouseout="this.style.backgroundColor='white'; this.style.color='#B71C1C'"
          >
            {{ option.label }}
            <small style="display: block; font-size: 11px; color: var(--muted-text-color, #999);">{{ option.description }}</small>
          </button>
        </div>
      </div>
      
      <!-- Search Options -->
      <div *ngIf="getMenuOptionsByCategory('search').length > 0" class="option-category" style="margin-bottom: 20px;">
        <h4 style="color: var(--primary-color, #2196F3); margin-bottom: 10px;">Filter Criteria</h4>
        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
          <button 
            *ngFor="let option of getMenuOptionsByCategory('search')"
            (click)="addJobParameter(option.id)"
            class="menu-option-button"
            style="padding: 8px 16px; border: 1px solid var(--primary-color, #2196F3); background: white; color: var(--primary-color, #2196F3); border-radius: 4px; cursor: pointer; transition: all 0.2s;"
            onmouseover="this.style.backgroundColor='var(--primary-color, #2196F3)'; this.style.color='white'"
            onmouseout="this.style.backgroundColor='white'; this.style.color='var(--primary-color, #2196F3)'"
          >
            {{ option.label }}
            <small style="display: block; font-size: 11px; color: var(--muted-text-color, #999);">{{ option.description }}</small>
          </button>
        </div>
      </div>
      
      <!-- Modification Options -->
      <div *ngIf="getMenuOptionsByCategory('modification').length > 0" class="option-category" style="margin-bottom: 20px;">
        <h4 style="color: #1A237E; margin-bottom: 10px;">Modification Options</h4>
        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
          <button 
            *ngFor="let option of getMenuOptionsByCategory('modification')"
            (click)="addJobParameter(option.id)"
            class="menu-option-button"
            style="padding: 8px 16px; border: 1px solid #1A237E; background: white; color: #1A237E; border-radius: 4px; cursor: pointer; transition: all 0.2s;"
            onmouseover="this.style.backgroundColor='#1A237E'; this.style.color='white'"
            onmouseout="this.style.backgroundColor='white'; this.style.color='#1A237E'"
          >
            {{ option.label }}
            <small style="display: block; font-size: 11px; color: var(--muted-text-color, #999);">{{ option.description }}</small>
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Processing Logs -->
<div *ngIf="processLogs && processLogs.length > 0" class="processing-results" style="margin-top: 30px; padding: 15px; border: 1px solid var(--border-color, #ddd); border-radius: 5px; background: white;">
  <h3 style="color: var(--text-color, #333);">Processing Results</h3>
  
  <!-- Summary -->
  <div class="summary-box" style="margin-bottom: 20px; padding: 10px; background-color: var(--success-background, #e8f5e8); border-radius: 4px; border-left: 4px solid var(--success-color, #4CAF50);">
    <div style="font-weight: bold; color: var(--success-color, #2E7D32);">Summary:</div>
    <div style="color: var(--text-color, #333);">Total users processed: {{ processLogs.length }}</div>
    <div style="color: var(--text-color, #333);">Users with changes: {{ processLogsWithChanges.length }}</div>
    <div style="color: var(--text-color, #333);">Users with no matching notes: {{ processLogs.length - processLogsWithChanges.length }}</div>
  </div>
  
  <!-- Action Buttons -->
  <div style="margin-bottom: 20px; display: flex; gap: 10px; justify-content: center;">
    <button 
      (click)="showResults = !showResults"
      style="background: var(--primary-color, #2196F3); color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; font-weight: bold;"
    >
      {{ showResults ? 'Hide Results' : 'View Results' }}
    </button>
    <button 
      (click)="exportResultsToCSV()"
      style="background: var(--success-color, #4CAF50); color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; font-weight: bold;"
    >
      Export to CSV
    </button>
  </div>
  
  <!-- Detailed Results (collapsible) -->
  <div *ngIf="showResults">
    <!-- Show message if no users had changes -->
    <div *ngIf="processLogsWithChanges.length === 0" style="text-align: center; color: var(--muted-text-color, #666); font-style: italic; padding: 20px;">
      No users had notes that were modified or deleted.
    </div>
    
    <!-- Show only users with changes -->
    <div *ngIf="processLogsWithChanges.length > 0" style="max-height: 400px; overflow-y: auto; border: 1px solid var(--border-color, #eee); padding: 10px; background: white;">
    <div *ngFor="let log of processLogsWithChanges" class="user-change-card" style="margin-bottom: 15px; padding-bottom: 15px; border-bottom: 1px solid var(--border-color, #ddd);">
      <h4 style="color: var(--primary-color, #1976D2); margin-bottom: 10px;">User ID: {{ log.userId }}</h4>
      <div>
        <div *ngFor="let entry of log.notes" class="note-entry" style="margin-top: 10px; padding: 10px; background: white; border: 1px solid var(--border-color, #ddd); border-radius: 4px;">
          <div *ngIf="entry.deleted" style="color: var(--error-color, #d32f2f); font-weight: bold; margin-bottom: 8px;">üìù NOTE DELETED</div>
          <div *ngIf="!entry.deleted" style="color: var(--warning-color, #FF9800); font-weight: bold; margin-bottom: 8px;">üìù NOTE MODIFIED</div>
          
          <div *ngIf="!entry.deleted">
            <div style="margin-bottom: 8px;">
              <strong style="color: var(--text-color, #333);">Before:</strong>
              <div class="before-after-box" style="padding: 5px; background: white; border-left: 3px solid var(--primary-color, #2196f3); margin-top: 4px;">
                <div style="color: var(--text-color, #333);"><strong>Text:</strong> {{ entry.before.note_text }}</div>
                <div style="color: var(--text-color, #333);"><strong>Created:</strong> {{ formatNoteDate(entry.before) }}</div>
                <div style="color: var(--text-color, #333);"><strong>Popup:</strong> {{ entry.before.popup_note ? 'Yes' : 'No' }}</div>
                <div style="color: var(--text-color, #333);"><strong>Type:</strong> {{ entry.before.note_type?.desc || 'None' }}</div>
              </div>
            </div>
            <div *ngIf="entry.after">
              <strong style="color: var(--text-color, #333);">After:</strong>
              <div class="before-after-box" style="padding: 5px; background: white; border-left: 3px solid var(--success-color, #4CAF50); margin-top: 4px;">
                <div style="color: var(--text-color, #333);"><strong>Text:</strong> {{ entry.after.note_text }}</div>
                <div style="color: var(--text-color, #333);"><strong>Created:</strong> {{ formatNoteDate(entry.after) }}</div>
                <div style="color: var(--text-color, #333);"><strong>Popup:</strong> {{ entry.after.popup_note ? 'Yes' : 'No' }}</div>
                <div style="color: var(--text-color, #333);"><strong>Type:</strong> {{ entry.after.note_type?.desc || 'None' }}</div>
              </div>
            </div>
          </div>
          
          <div *ngIf="entry.deleted">
            <div style="margin-bottom: 8px;">
              <strong style="color: var(--text-color, #333);">Deleted Note:</strong>
              <div class="before-after-box" style="padding: 5px; background: white; border-left: 3px solid var(--error-color, #d32f2f); margin-top: 4px;">
                <div style="color: var(--text-color, #333);"><strong>Text:</strong> {{ entry.before.note_text }}</div>
                <div style="color: var(--text-color, #333);"><strong>Created:</strong> {{ formatNoteDate(entry.before) }}</div>
                <div style="color: var(--text-color, #333);"><strong>Popup:</strong> {{ entry.before.popup_note ? 'Yes' : 'No' }}</div>
                <div style="color: var(--text-color, #333);"><strong>Type:</strong> {{ entry.before.note_type?.desc || 'None' }}</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- User display with note highlighting -->
<div>
  <!-- Show set summary before job execution -->
  <section *ngIf="users && users.length > 0 && !jobExecuted" style="margin-top: 30px; border: 3px solid var(--primary-color, #2196F3); padding: 20px; border-radius: 8px; background: white;">
    <h2 style="color: white; margin-top: 0; background: var(--primary-color, #2196F3); padding: 10px; margin: -20px -20px 20px -20px; border-radius: 5px 5px 0 0;">
      üìã Set Summary
    </h2>
    
    <div style="padding: 20px; background: white; border-radius: 5px;">
      <!-- Summary Cards -->
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 20px;">
        
        <!-- Total Users Card -->
        <div style="padding: 20px; border: 2px solid var(--success-color, #4CAF50); border-radius: 8px; background: white; text-align: center;">
          <div style="font-size: 2em; font-weight: bold; color: var(--success-color, #4CAF50);">{{ totalUsersInSet }}</div>
          <div style="font-size: 1.1em; color: var(--success-color, #2E7D32); margin-top: 5px;">Total Users in Set</div>
        </div>
        
        <!-- Users with Notes Card -->
        <div style="padding: 20px; border: 2px solid var(--warning-color, #FF9800); border-radius: 8px; background: white; text-align: center;">
          <div style="font-size: 2em; font-weight: bold; color: var(--warning-color, #FF9800);">{{ totalUsersWithNotes }}</div>
          <div style="font-size: 1.1em; color: var(--warning-color, #F57C00); margin-top: 5px;">Users with Notes</div>
          <div style="font-size: 0.9em; color: var(--muted-text-color, #666); margin-top: 5px;">(Will be processed by job)</div>
        </div>
        
        <!-- Users without Notes Card -->
        <div style="padding: 20px; border: 2px solid var(--muted-text-color, #9E9E9E); border-radius: 8px; background: white; text-align: center;">
          <div style="font-size: 2em; font-weight: bold; color: var(--muted-text-color, #757575);">{{ totalUsersWithoutNotes }}</div>
          <div style="font-size: 1.1em; color: var(--muted-text-color, #616161); margin-top: 5px;">Users without Notes</div>
          <div style="font-size: 0.9em; color: var(--muted-text-color, #666); margin-top: 5px;">(Will be skipped)</div>
        </div>
      </div>
      
      <!-- Additional Info -->
      <div style="background: white; padding: 15px; border-radius: 5px; border-left: 4px solid var(--primary-color, #2196F3); border: 1px solid var(--border-color, #ddd);">
        <h4 style="margin-top: 0; color: var(--primary-color, #1976D2);">üí° Processing Information</h4>
        <ul style="margin-bottom: 0; color: var(--text-color, #424242);">
          <li>Only users with notes will be processed during job execution</li>
          <li>Users without notes will be automatically skipped for efficiency</li>
          <li>Configure your job parameters above, then click "Execute Job" to begin</li>
        </ul>
      </div>
    </div>
  </section>
  
  <!-- Debugging section for when users should exist but don't show -->
  <section *ngIf="selectedSet && setMembers && setMembers.length > 0 && (!users || users.length === 0) && !loading" style="margin-top: 30px; border: 3px solid var(--warning-color, #FF9800); padding: 20px; border-radius: 8px; background: white;">
    <h2 style="color: var(--warning-color, #FF9800); margin-top: 0;">‚ö†Ô∏è Debug: Users Not Loading</h2>
    <p style="color: var(--text-color, #333);">Set is selected and members are found, but user details are not loading.</p>
    <p style="color: var(--text-color, #333);"><strong>Set Members Found:</strong> {{ setMembers.length }}</p>
    <p style="color: var(--text-color, #333);"><strong>User Details Loaded:</strong> {{ userDetails.length || 0 }}</p>
    <p style="color: var(--text-color, #333);"><strong>Users Getter Result:</strong> {{ users.length || 0 }}</p>
    <p style="color: var(--text-color, #333);"><strong>Loading State:</strong> {{ loading }}</p>
    <div style="background: white; border: 1px solid var(--border-color, #ddd); padding: 10px; margin-top: 10px;">
      <strong style="color: var(--text-color, #333);">First few set members:</strong>
      <div *ngFor="let member of setMembers.slice(0, 3)" style="color: var(--text-color, #333);">
        - {{ member.name }} ({{ member.id }})
      </div>
    </div>
  </section>
  
  <!-- Show basic set member info -->
  <section *ngIf="setMembers && setMembers.length > 0 && (!users || users.length === 0)" style="margin-top: 50px;">
    <h2 style="color: var(--primary-color, #2196F3);">Set Members</h2>
    <ul style="padding: 10px;">
      <li style="margin: 5px 0; color: var(--text-color, #333);" *ngFor="let member of setMembers">
        <strong>Name:</strong> {{ member.name }} | 
        <strong>Id:</strong> {{ member.id }} | 
        <strong>Description:</strong> {{ member.description }} | 
        <strong>Link:</strong> <a href="{{member.link}}" target="_blank" style="color: var(--primary-color, #2196F3);">{{member.link}}</a>
      </li>
    </ul>
  </section>
  
  <!-- Show empty list template when nothing is available -->
  <section *ngIf="selectedSet && (!setMembers || setMembers.length === 0) && !loading" style="margin-top: 50px;">
    <ng-container *ngTemplateOutlet="emptyList"></ng-container>
  </section>
  
  <!-- Loading indicator -->
  <section *ngIf="loading || processingNotes" style="margin-top: 50px;">
    <div class="loading-indicator">
      <span>{{ processingNotes ? 'Processing notes...' : 'Loading data...' }}</span>
    </div>
  </section>
  
  <!-- Empty list template -->
  <ng-template #emptyList>
    <div id="emptyList">
      <span class="uxf-icon uxf-list" style="font-size: 3em;"></span>
      <div>No items found for this set.</div>
    </div>
  </ng-template>
</div>